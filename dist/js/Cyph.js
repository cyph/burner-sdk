(function(t,e,n){"use strict";var r=function(){return b.__string_rec(this,"")};function i(t,e){function n(){}n.prototype=t;var r=new n;for(var i in e)r[i]=e[i];if(e.toString!==Object.prototype.toString)r.toString=e.toString;return r}var a=function(){};a.__name__=true;a.cca=function(t,e){var n=t.charCodeAt(e);if(n!=n)return undefined;return n};a.indexOf=function(t,e,n){var r=t.length;if(n<0){n+=r;if(n<0)n=0}while(n<r){if(t[n]===e)return n;n++}return-1};var o=e.Cyph=function(){};o.__name__=true;o.generateGuid=function(t){var e=t*4;var n=s.getSecureRandomBytes(e);var r=y.fromBytes(n);var i=0;while(i<t){var a=i++;n.set(a,o.addressSpace[u["int"](Math.floor(f.toFloat(r[a])/4294967296*o.addressSpace.length))])}var _=new c(n,0,t).readString(t);n.fill(0,e,0);return _};o.initiateSession=function(t){if(t==null)t=[];return"https://"+(a.indexOf(t,o.options.video,0)>-1?o.services.video:a.indexOf(t,o.options.voice,0)>-1?o.services.voice:o.services.chat)+"/#"+(a.indexOf(t,o.options.modestBranding,0)>-1?"&":"")+(a.indexOf(t,o.options.disableP2P,0)>-1?"$":"")+(a.indexOf(t,o.options.nativeCrypto,0)>-1?"%":"")+o.generateGuid(26)};Math.__name__=true;var s=function(){};s.__name__=true;s.getSecureRandomBytes=function(t){var e="";try{var n=typeof crypto==="undefined"?require("crypto"):crypto;var r=n.randomBytes?n.randomBytes(t):n.getRandomValues(new T(t));var i=l.alloc(t);var a=0;while(a<t){var o=a++;i.b[o]=r[o]&255}return i}catch(s){if(s instanceof d)s=s.val;e=""+u.string(s)}throw new d("Can't find a secure source of random bytes. Reason: "+e)};var u=function(){};u.__name__=true;u.string=function(t){return b.__string_rec(t,"")};u["int"]=function(t){return t|0};var f={};f.__name__=true;f.toFloat=function(t){var e=t;if(e<0)return 4294967296+e;else return e+0};var _=function(t,e){this.high=t;this.low=e};_.__name__=true;_.prototype={__class__:_};var l=function(t){this.length=t.byteLength;this.b=new T(t);this.b.bufferValue=t;t.hxBytes=this;t.bytes=this.b};l.__name__=true;l.alloc=function(t){return new l(new M(t))};l.prototype={set:function(t,e){this.b[t]=e&255},fill:function(t,e,n){var r=0;while(r<e){var i=r++;this.set(t++,n)}},getString:function(t,e){if(t<0||e<0||t+e>this.length)throw new d(g.OutsideBounds);var n="";var r=this.b;var i=String.fromCharCode;var a=t;var o=t+e;while(a<o){var s=r[a++];if(s<128){if(s==0)break;n+=i(s)}else if(s<224)n+=i((s&63)<<6|r[a++]&127);else if(s<240){var u=r[a++];n+=i((s&31)<<12|(u&127)<<6|r[a++]&127)}else{var f=r[a++];var _=r[a++];var l=(s&15)<<18|(f&127)<<12|(_&127)<<6|r[a++]&127;n+=i((l>>10)+55232);n+=i(l&1023|56320)}}return n},toString:function(){return this.getString(0,this.length)},__class__:l};var h=function(){};h.__name__=true;h.prototype={readByte:function(){throw new d("Not implemented")},readBytes:function(t,e,n){var r=n;var i=t.b;if(e<0||n<0||e+n>t.length)throw new d(g.OutsideBounds);while(r>0){i[e]=this.readByte();e++;r--}return n},readFullBytes:function(t,e,n){while(n>0){var r=this.readBytes(t,e,n);e+=r;n-=r}},readString:function(t){var e=l.alloc(t);this.readFullBytes(e,0,t);return e.toString()},__class__:h};var c=function(t,e,n){if(e==null)e=0;if(n==null)n=t.length-e;if(e<0||n<0||e+n>t.length)throw new d(g.OutsideBounds);this.b=t.b;this.pos=e;this.len=n;this.totlen=n};c.__name__=true;c.__super__=h;c.prototype=i(h.prototype,{readByte:function(){if(this.len==0)throw new d(new v);this.len--;return this.b[this.pos++]},readBytes:function(t,e,n){if(e<0||n<0||e+n>t.length)throw new d(g.OutsideBounds);if(this.len==0&&n>0)throw new d(new v);if(this.len<n)n=this.len;var r=this.b;var i=t.b;var a=0;while(a<n){var o=a++;i[e+o]=r[this.pos+o]}this.pos+=n;this.len-=n;return n},__class__:c});var v=function(){};v.__name__=true;v.prototype={toString:function(){return"Eof"},__class__:v};var g={__ename__:true,__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]};g.Blocked=["Blocked",0];g.Blocked.toString=r;g.Blocked.__enum__=g;g.Overflow=["Overflow",1];g.Overflow.toString=r;g.Overflow.__enum__=g;g.OutsideBounds=["OutsideBounds",2];g.OutsideBounds.toString=r;g.OutsideBounds.__enum__=g;g.Custom=function(t){var e=["Custom",3,t];e.__enum__=g;e.toString=r;return e};var p=function(){};p.__name__=true;p.i32ToFloat=function(t){var e=1-(t>>>31<<1);var n=t>>>23&255;var r=t&8388607;if(r==0&&n==0)return 0;return e*(1+Math.pow(2,-23)*r)*Math.pow(2,n-127)};p.floatToI32=function(t){if(t==0)return 0;var e;if(t<0)e=-t;else e=t;var n=Math.floor(Math.log(e)/.6931471805599453);if(n<-127)n=-127;else if(n>128)n=128;var r=Math.round((e/Math.pow(2,n)-1)*8388608)&8388607;return(t<0?-2147483648:0)|n+127<<23|r};p.i64ToDouble=function(t,e){var n=1-(e>>>31<<1);var r=(e>>20&2047)-1023;var i=(e&1048575)*4294967296+(t>>>31)*2147483648+(t&2147483647);if(i==0&&r==-1023)return 0;return n*(1+Math.pow(2,-52)*i)*Math.pow(2,r)};p.doubleToI64=function(t){var e=p.i64tmp;if(t==0){e.low=0;e.high=0}else{var n;if(t<0)n=-t;else n=t;var r=Math.floor(Math.log(n)/.6931471805599453);var i;var a=(n/Math.pow(2,r)-1)*4503599627370496;i=Math.round(a);var o=i|0;var s=i/4294967296|0;e.low=o;e.high=(t<0?-2147483648:0)|r+1023<<20|s}return e};var y={};y.__name__=true;y.fromData=function(t){return t};y.fromBytes=function(t,e,n){if(e==null)e=0;if(n==null)n=t.length-e>>2;return y.fromData(new Uint32Array(t.b.bufferValue,e,n))};var d=function(t){Error.call(this);this.val=t;this.message=String(t);if(Error.captureStackTrace)Error.captureStackTrace(this,d)};d.__name__=true;d.__super__=Error;d.prototype=i(Error.prototype,{__class__:d});var b=function(){};b.__name__=true;b.getClass=function(t){if(t instanceof Array&&t.__enum__==null)return Array;else{var e=t.__class__;if(e!=null)return e;var n=b.__nativeClassName(t);if(n!=null)return b.__resolveNativeClass(n);return null}};b.__string_rec=function(t,e){if(t==null)return"null";if(e.length>=5)return"<...>";var n=typeof t;if(n=="function"&&(t.__name__||t.__ename__))n="object";switch(n){case"object":if(t instanceof Array){if(t.__enum__){if(t.length==2)return t[0];var r=t[0]+"(";e+="	";var i=2;var a=t.length;while(i<a){var o=i++;if(o!=2)r+=","+b.__string_rec(t[o],e);else r+=b.__string_rec(t[o],e)}return r+")"}var s=t.length;var u;var f="[";e+="	";var _=0;while(_<s){var l=_++;f+=(l>0?",":"")+b.__string_rec(t[l],e)}f+="]";return f}var h;try{h=t.toString}catch(c){if(c instanceof d)c=c.val;return"???"}if(h!=null&&h!=Object.toString&&typeof h=="function"){var v=t.toString();if(v!="[object Object]")return v}var g=null;var p="{\n";e+="	";var y=t.hasOwnProperty!=null;for(var g in t){if(y&&!t.hasOwnProperty(g)){continue}if(g=="prototype"||g=="__class__"||g=="__super__"||g=="__interfaces__"||g=="__properties__"){continue}if(p.length!=2)p+=", \n";p+=e+g+" : "+b.__string_rec(t[g],e)}e=e.substring(1);p+="\n"+e+"}";return p;case"function":return"<function>";case"string":return t;default:return String(t)}};b.__interfLoop=function(t,e){if(t==null)return false;if(t==e)return true;var n=t.__interfaces__;if(n!=null){var r=0;var i=n.length;while(r<i){var a=r++;var o=n[a];if(o==e||b.__interfLoop(o,e))return true}}return b.__interfLoop(t.__super__,e)};b.__instanceof=function(t,e){if(e==null)return false;switch(e){case S:return(t|0)===t;case L:return typeof t=="number";case C:return typeof t=="boolean";case String:return typeof t=="string";case Array:return t instanceof Array&&t.__enum__==null;case B:return true;default:if(t!=null){if(typeof e=="function"){if(t instanceof e)return true;if(b.__interfLoop(b.getClass(t),e))return true}else if(typeof e=="object"&&b.__isNativeObj(e)){if(t instanceof e)return true}}else return false;if(e==A&&t.__name__!=null)return true;if(e==I&&t.__ename__!=null)return true;return t.__enum__==e}};b.__nativeClassName=function(t){var e=b.__toStr.call(t).slice(8,-1);if(e=="Object"||e=="Function"||e=="Math"||e=="JSON")return null;return e};b.__isNativeObj=function(t){return b.__nativeClassName(t)!=null};b.__resolveNativeClass=function(t){return n[t]};var w=function(t){if(t instanceof Array&&t.__enum__==null){this.a=t;this.byteLength=t.length}else{var e=t;this.a=[];var n=0;while(n<e){var r=n++;this.a[r]=0}this.byteLength=e}};w.__name__=true;w.sliceImpl=function(t,e){var n=new T(this,t,e==null?null:e-t);var r=new M(n.byteLength);var i=new T(r);i.set(n);return r};w.prototype={slice:function(t,e){return new w(this.a.slice(t,e))},__class__:w};var m=function(t,e,n){this.buf=t;if(e==null)this.offset=0;else this.offset=e;if(n==null)this.length=t.byteLength-this.offset;else this.length=n;if(this.offset<0||this.length<0||this.offset+this.length>t.byteLength)throw new d(g.OutsideBounds)};m.__name__=true;m.prototype={getInt8:function(t){var e=this.buf.a[this.offset+t];if(e>=128)return e-256;else return e},getUint8:function(t){return this.buf.a[this.offset+t]},getInt16:function(t,e){var n=this.getUint16(t,e);if(n>=32768)return n-65536;else return n},getUint16:function(t,e){if(e)return this.buf.a[this.offset+t]|this.buf.a[this.offset+t+1]<<8;else return this.buf.a[this.offset+t]<<8|this.buf.a[this.offset+t+1]},getInt32:function(t,e){var n=this.offset+t;var r=this.buf.a[n++];var i=this.buf.a[n++];var a=this.buf.a[n++];var o=this.buf.a[n++];if(e)return r|i<<8|a<<16|o<<24;else return o|a<<8|i<<16|r<<24},getUint32:function(t,e){var n=this.getInt32(t,e);if(n<0)return n+4294967296;else return n},getFloat32:function(t,e){return p.i32ToFloat(this.getInt32(t,e))},getFloat64:function(t,e){var n=this.getInt32(t,e);var r=this.getInt32(t+4,e);return p.i64ToDouble(e?n:r,e?r:n)},setInt8:function(t,e){if(e<0)this.buf.a[t+this.offset]=e+128&255;else this.buf.a[t+this.offset]=e&255},setUint8:function(t,e){this.buf.a[t+this.offset]=e&255},setInt16:function(t,e,n){this.setUint16(t,e<0?e+65536:e,n)},setUint16:function(t,e,n){var r=t+this.offset;if(n){this.buf.a[r]=e&255;this.buf.a[r++]=e>>8&255}else{this.buf.a[r++]=e>>8&255;this.buf.a[r]=e&255}},setInt32:function(t,e,n){this.setUint32(t,e,n)},setUint32:function(t,e,n){var r=t+this.offset;if(n){this.buf.a[r++]=e&255;this.buf.a[r++]=e>>8&255;this.buf.a[r++]=e>>16&255;this.buf.a[r++]=e>>>24}else{this.buf.a[r++]=e>>>24;this.buf.a[r++]=e>>16&255;this.buf.a[r++]=e>>8&255;this.buf.a[r++]=e&255}},setFloat32:function(t,e,n){this.setUint32(t,p.floatToI32(e),n)},setFloat64:function(t,e,n){var r=p.doubleToI64(e);if(n){this.setUint32(t,r.low);this.setUint32(t,r.high)}else{this.setUint32(t,r.high);this.setUint32(t,r.low)}},__class__:m};var O=function(){};O.__name__=true;O._new=function(t,e,n){var r;if(typeof t=="number"){r=[];var i=0;while(i<t){var a=i++;r[a]=0}r.byteLength=r.length;r.byteOffset=0;r.buffer=new w(r)}else if(b.__instanceof(t,w)){var o=t;if(e==null)e=0;if(n==null)n=o.byteLength-e;if(e==0)r=o.a;else r=o.a.slice(e,e+n);r.byteLength=r.length;r.byteOffset=e;r.buffer=o}else if(t instanceof Array&&t.__enum__==null){r=t.slice();r.byteLength=r.length;r.byteOffset=0;r.buffer=new w(r)}else throw new d("TODO "+u.string(t));r.subarray=O._subarray;r.set=O._set;return r};O._set=function(t,e){var n=this;if(b.__instanceof(t.buffer,w)){var r=t;if(t.byteLength+e>n.byteLength)throw new d("set() outside of range");var i=0;var a=t.byteLength;while(i<a){var o=i++;n[o+e]=r[o]}}else if(t instanceof Array&&t.__enum__==null){var s=t;if(s.length+e>n.byteLength)throw new d("set() outside of range");var u=0;var f=s.length;while(u<f){var _=u++;n[_+e]=s[_]}}else throw new d("TODO")};O._subarray=function(t,e){var n=this;var r=O._new(n.slice(t,e));r.byteOffset=t;return r};if(Array.prototype.indexOf)a.indexOf=function(t,e,n){return Array.prototype.indexOf.call(t,e,n)};String.prototype.__class__=String;String.__name__=true;Array.__name__=true;var S={__name__:["Int"]};var B={__name__:["Dynamic"]};var L=Number;L.__name__=["Float"];var C=Boolean;C.__ename__=["Bool"];var A={__name__:["Class"]};var I={};if(Array.prototype.map==null)Array.prototype.map=function(t){var e=[];var n=0;var r=this.length;while(n<r){var i=n++;e[i]=t(this[i])}return e};var M=n.ArrayBuffer||w;if(M.prototype.slice==null)M.prototype.slice=w.sliceImpl;var U=n.DataView||m;var T=n.Uint8Array||O._new;o.addressSpace=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"].map(function(t){return a.cca(t,0)});o.services={chat:"cyph.im",voice:"cyph.audio",video:"cyph.video"};o.options={voice:1,video:2,modestBranding:3,disableP2P:4,nativeCrypto:5};p.i64tmp=function(t){var e;var n=new _(0,0);e=n;return e}(this);b.__toStr={}.toString;O.BYTES_PER_ELEMENT=1})(typeof console!="undefined"?console:{log:function(){}},typeof window!="undefined"?window:exports,typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:this);