(function(t,e,n){"use strict";var r=function(){return B.__string_rec(this,"")};function i(t,e){function n(){}n.prototype=t;var r=new n;for(var i in e)r[i]=e[i];if(e.toString!==Object.prototype.toString)r.toString=e.toString;return r}var a=function(){};a.__name__=true;a.cca=function(t,e){var n=t.charCodeAt(e);if(n!=n)return undefined;return n};a.indexOf=function(t,e,n){var r=t.length;if(n<0){n+=r;if(n<0)n=0}while(n<r){if(t[n]===e)return n;n++}return-1};var s=e.Cyph=function(){};s.__name__=true;s.generateGuid=function(t){var e=t*4;var n=h.getSecureRandomBytes(e);var r=O.fromBytes(n);var i=0;while(i<t){var a=i++;n.set(a,s.addressSpace[_["int"](Math.floor(c.toFloat(r[a])/4294967296*s.addressSpace.length))])}var o=new y(n,0,t).readString(t);n.fill(0,e,0);return o};s.request=function(t,e,n,r,i,a){var s=function(){try{return typeof s!=="undefined"?s:require("node-fetch")}catch(t){}}();if(s){var o={headers:n.reduce(function(t,e){t[e.k]=e.v;return t},{}),method:e?"POST":"GET"};if(e&&r.length>0){o.headers["Content-Type"]="application/x-www-form-urlencoded";o.body=r.map(function(t){return t.k+"="+t.v}).join("&")}s(t,o).then(function(t){var e=t.text().then(function(t){return t.trim()});if(t.ok){return e}else{return e.then(function(t){throw new Error(t)})}}).then(i).catch(a);return}var u=new v(t);u.onData=i;u.onError=a;if(e)u.setPostData("");var f=0;while(f<n.length){var l=n[f];++f;u.setHeader(l.k,l.v)}var h=0;while(h<r.length){var _=r[h];++h;u.setParameter(_.k,_.v)}u.request(e)};s.generateLink=function(t,e){var n=s.generateGuid(7);return{id:n,link:(a.indexOf(t,s.options.telehealth,0)>-1?e.telehealth:a.indexOf(t,s.options.video,0)>-1?e.video:a.indexOf(t,s.options.voice,0)>-1?e.voice:e.chat)+(a.indexOf(t,s.options.modestBranding,0)>-1?"!":"")+(a.indexOf(t,s.options.disableP2P,0)>-1?"$":"")+n+s.generateGuid(19)}};s.initiateSession=function(t,e,n,r,i){if(e==null)e=[];else{}if(n==null)n=s.services;else{}if(n.backend==null)n.backend=s.services.backend;if(n.telehealth==null)n.telehealth=n.chat+"video/";if(n.video==null)n.video=n.chat+"video/";if(n.voice==null)n.voice=n.chat+"audio/";var a=s.generateLink(e,n);s.request(n.backend+"/preauth/"+a.id,true,[{k:"Authorization",v:t}],[],function(t){r(a.link)},i)};var o=function(t,e){e=e.split("u").join("");this.r=new RegExp(t,e)};o.__name__=true;o.prototype={match:function(t){if(this.r.global)this.r.lastIndex=0;this.r.m=this.r.exec(t);this.r.s=t;return this.r.m!=null},__class__:o};var u=function(){};u.__name__=true;u.exists=function(t,e){var n=t.iterator();while(n.hasNext()){var r=n.next();if(e(r))return true}return false};u.filter=function(t,e){var n=new f;var r=t.iterator();while(r.hasNext()){var i=r.next();if(e(i))n.add(i)}return n};var f=function(){this.length=0};f.__name__=true;f.prototype={add:function(t){var e=[t];if(this.h==null)this.h=e;else this.q[1]=e;this.q=e;this.length++},push:function(t){var e=[t,this.h];this.h=e;if(this.q==null)this.q=e;this.length++},iterator:function(){return new l(this.h)},__class__:f};var l=function(t){this.head=t;this.val=null};l.__name__=true;l.prototype={hasNext:function(){return this.head!=null},next:function(){this.val=this.head[0];this.head=this.head[1];return this.val},__class__:l};Math.__name__=true;var h=function(){};h.__name__=true;h.getSecureRandomBytes=function(t){var e="";try{var n=typeof crypto==="undefined"?require("crypto"):crypto;var r=n.randomBytes?n.randomBytes(t):n.getRandomValues(new j(t));var i=d.alloc(t);var a=0;while(a<t){var s=a++;i.b[s]=r[s]&255}return i}catch(t){if(t instanceof S)t=t.val;e=""+_.string(t)}throw new S("Can't find a secure source of random bytes. Reason: "+e)};var _=function(){};_.__name__=true;_.string=function(t){return B.__string_rec(t,"")};_["int"]=function(t){return t|0};var c={};c.__name__=true;c.toFloat=function(t){var e=t;if(e<0)return 4294967296+e;else return e+0};var v=function(t){this.url=t;this.headers=new f;this.params=new f;this.async=true};v.__name__=true;v.prototype={setHeader:function(t,e){this.headers=u.filter(this.headers,function(e){return e.header!=t});this.headers.push({header:t,value:e});return this},setParameter:function(t,e){this.params=u.filter(this.params,function(e){return e.param!=t});this.params.push({param:t,value:e});return this},setPostData:function(t){this.postData=t;return this},request:function(t){var e=this;e.responseData=null;var n=this.req=x.createXMLHttpRequest();var r=function(t){if(n.readyState!=4)return;var r;try{r=n.status}catch(t){if(t instanceof S)t=t.val;r=null}if(r!=null){var i=window.location.protocol.toLowerCase();var a=new o("^(?:about|app|app-storage|.+-extension|file|res|widget):$","");var s=a.match(i);if(s)if(n.responseText!=null)r=200;else r=404}if(r==undefined)r=null;if(r!=null)e.onStatus(r);if(r!=null&&r>=200&&r<400){e.req=null;e.onData(e.responseData=n.responseText)}else if(r==null){e.req=null;e.onError("Failed to connect or resolve host")}else switch(r){case 12029:e.req=null;e.onError("Failed to connect to host");break;case 12007:e.req=null;e.onError("Unknown host");break;default:e.req=null;e.responseData=n.responseText;e.onError("Http Error #"+n.status)}};if(this.async)n.onreadystatechange=r;var i=this.postData;if(i!=null)t=true;else{var a=this.params.h;var s=null;while(a!=null){var f;f=function(t){var e;s=a[0];a=a[1];e=s;return e}(this);if(i==null)i="";else i+="&";i+=encodeURIComponent(f.param)+"="+encodeURIComponent(f.value)}}try{if(t)n.open("POST",this.url,this.async);else if(i!=null){var l=this.url.split("?").length<=1;n.open("GET",this.url+(l?"?":"&")+i,this.async);i=null}else n.open("GET",this.url,this.async)}catch(t){if(t instanceof S)t=t.val;e.req=null;this.onError(t.toString());return}if(!u.exists(this.headers,function(t){return t.header=="Content-Type"})&&t&&this.postData==null)n.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var h=this.headers.h;var _=null;while(h!=null){var c;c=function(t){var e;_=h[0];h=h[1];e=_;return e}(this);n.setRequestHeader(c.header,c.value)}n.send(i);if(!this.async)r(null)},onData:function(t){},onError:function(t){},onStatus:function(t){},__class__:v};var p=function(t,e){this.high=t;this.low=e};p.__name__=true;p.prototype={__class__:p};var d=function(t){this.length=t.byteLength;this.b=new j(t);this.b.bufferValue=t;t.hxBytes=this;t.bytes=this.b};d.__name__=true;d.alloc=function(t){return new d(new D(t))};d.prototype={set:function(t,e){this.b[t]=e&255},fill:function(t,e,n){var r=0;while(r<e){var i=r++;this.set(t++,n)}},getString:function(t,e){if(t<0||e<0||t+e>this.length)throw new S(b.OutsideBounds);var n="";var r=this.b;var i=String.fromCharCode;var a=t;var s=t+e;while(a<s){var o=r[a++];if(o<128){if(o==0)break;n+=i(o)}else if(o<224)n+=i((o&63)<<6|r[a++]&127);else if(o<240){var u=r[a++];n+=i((o&31)<<12|(u&127)<<6|r[a++]&127)}else{var f=r[a++];var l=r[a++];var h=(o&15)<<18|(f&127)<<12|(l&127)<<6|r[a++]&127;n+=i((h>>10)+55232);n+=i(h&1023|56320)}}return n},toString:function(){return this.getString(0,this.length)},__class__:d};var g=function(){};g.__name__=true;g.prototype={readByte:function(){throw new S("Not implemented")},readBytes:function(t,e,n){var r=n;var i=t.b;if(e<0||n<0||e+n>t.length)throw new S(b.OutsideBounds);while(r>0){i[e]=this.readByte();e++;r--}return n},readFullBytes:function(t,e,n){while(n>0){var r=this.readBytes(t,e,n);e+=r;n-=r}},readString:function(t){var e=d.alloc(t);this.readFullBytes(e,0,t);return e.toString()},__class__:g};var y=function(t,e,n){if(e==null)e=0;if(n==null)n=t.length-e;if(e<0||n<0||e+n>t.length)throw new S(b.OutsideBounds);this.b=t.b;this.pos=e;this.len=n;this.totlen=n};y.__name__=true;y.__super__=g;y.prototype=i(g.prototype,{readByte:function(){if(this.len==0)throw new S(new w);this.len--;return this.b[this.pos++]},readBytes:function(t,e,n){if(e<0||n<0||e+n>t.length)throw new S(b.OutsideBounds);if(this.len==0&&n>0)throw new S(new w);if(this.len<n)n=this.len;var r=this.b;var i=t.b;var a=0;while(a<n){var s=a++;i[e+s]=r[this.pos+s]}this.pos+=n;this.len-=n;return n},__class__:y});var w=function(){};w.__name__=true;w.prototype={toString:function(){return"Eof"},__class__:w};var b={__ename__:true,__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]};b.Blocked=["Blocked",0];b.Blocked.toString=r;b.Blocked.__enum__=b;b.Overflow=["Overflow",1];b.Overflow.toString=r;b.Overflow.__enum__=b;b.OutsideBounds=["OutsideBounds",2];b.OutsideBounds.toString=r;b.OutsideBounds.__enum__=b;b.Custom=function(t){var e=["Custom",3,t];e.__enum__=b;e.toString=r;return e};var m=function(){};m.__name__=true;m.i32ToFloat=function(t){var e=1-(t>>>31<<1);var n=t>>>23&255;var r=t&8388607;if(r==0&&n==0)return 0;return e*(1+Math.pow(2,-23)*r)*Math.pow(2,n-127)};m.floatToI32=function(t){if(t==0)return 0;var e;if(t<0)e=-t;else e=t;var n=Math.floor(Math.log(e)/.6931471805599453);if(n<-127)n=-127;else if(n>128)n=128;var r=Math.round((e/Math.pow(2,n)-1)*8388608)&8388607;return(t<0?-2147483648:0)|n+127<<23|r};m.i64ToDouble=function(t,e){var n=1-(e>>>31<<1);var r=(e>>20&2047)-1023;var i=(e&1048575)*4294967296+(t>>>31)*2147483648+(t&2147483647);if(i==0&&r==-1023)return 0;return n*(1+Math.pow(2,-52)*i)*Math.pow(2,r)};m.doubleToI64=function(t){var e=m.i64tmp;if(t==0){e.low=0;e.high=0}else{var n;if(t<0)n=-t;else n=t;var r=Math.floor(Math.log(n)/.6931471805599453);var i;var a=(n/Math.pow(2,r)-1)*4503599627370496;i=Math.round(a);var s=i|0;var o=i/4294967296|0;e.low=s;e.high=(t<0?-2147483648:0)|r+1023<<20|o}return e};var O={};O.__name__=true;O.fromData=function(t){return t};O.fromBytes=function(t,e,n){if(e==null)e=0;if(n==null)n=t.length-e>>2;return O.fromData(new Uint32Array(t.b.bufferValue,e,n))};var S=function(t){Error.call(this);this.val=t;this.message=String(t);if(Error.captureStackTrace)Error.captureStackTrace(this,S)};S.__name__=true;S.__super__=Error;S.prototype=i(Error.prototype,{__class__:S});var B=function(){};B.__name__=true;B.getClass=function(t){if(t instanceof Array&&t.__enum__==null)return Array;else{var e=t.__class__;if(e!=null)return e;var n=B.__nativeClassName(t);if(n!=null)return B.__resolveNativeClass(n);return null}};B.__string_rec=function(t,e){if(t==null)return"null";if(e.length>=5)return"<...>";var n=typeof t;if(n=="function"&&(t.__name__||t.__ename__))n="object";switch(n){case"object":if(t instanceof Array){if(t.__enum__){if(t.length==2)return t[0];var r=t[0]+"(";e+="\t";var i=2;var a=t.length;while(i<a){var s=i++;if(s!=2)r+=","+B.__string_rec(t[s],e);else r+=B.__string_rec(t[s],e)}return r+")"}var o=t.length;var u;var f="[";e+="\t";var l=0;while(l<o){var h=l++;f+=(h>0?",":"")+B.__string_rec(t[h],e)}f+="]";return f}var _;try{_=t.toString}catch(t){if(t instanceof S)t=t.val;return"???"}if(_!=null&&_!=Object.toString&&typeof _=="function"){var c=t.toString();if(c!="[object Object]")return c}var v=null;var p="{\n";e+="\t";var d=t.hasOwnProperty!=null;for(var v in t){if(d&&!t.hasOwnProperty(v)){continue}if(v=="prototype"||v=="__class__"||v=="__super__"||v=="__interfaces__"||v=="__properties__"){continue}if(p.length!=2)p+=", \n";p+=e+v+" : "+B.__string_rec(t[v],e)}e=e.substring(1);p+="\n"+e+"}";return p;case"function":return"<function>";case"string":return t;default:return String(t)}};B.__interfLoop=function(t,e){if(t==null)return false;if(t==e)return true;var n=t.__interfaces__;if(n!=null){var r=0;var i=n.length;while(r<i){var a=r++;var s=n[a];if(s==e||B.__interfLoop(s,e))return true}}return B.__interfLoop(t.__super__,e)};B.__instanceof=function(t,e){if(e==null)return false;switch(e){case q:return(t|0)===t;case M:return typeof t=="number";case C:return typeof t=="boolean";case String:return typeof t=="string";case Array:return t instanceof Array&&t.__enum__==null;case E:return true;default:if(t!=null){if(typeof e=="function"){if(t instanceof e)return true;if(B.__interfLoop(B.getClass(t),e))return true}else if(typeof e=="object"&&B.__isNativeObj(e)){if(t instanceof e)return true}}else return false;if(e==A&&t.__name__!=null)return true;if(e==U&&t.__ename__!=null)return true;return t.__enum__==e}};B.__nativeClassName=function(t){var e=B.__toStr.call(t).slice(8,-1);if(e=="Object"||e=="Function"||e=="Math"||e=="JSON")return null;return e};B.__isNativeObj=function(t){return B.__nativeClassName(t)!=null};B.__resolveNativeClass=function(t){return n[t]};var x=function(){};x.__name__=true;x.createXMLHttpRequest=function(){if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")return new ActiveXObject("Microsoft.XMLHTTP");throw new S("Unable to create XMLHttpRequest object.")};var L=function(t){if(t instanceof Array&&t.__enum__==null){this.a=t;this.byteLength=t.length}else{var e=t;this.a=[];var n=0;while(n<e){var r=n++;this.a[r]=0}this.byteLength=e}};L.__name__=true;L.sliceImpl=function(t,e){var n=new j(this,t,e==null?null:e-t);var r=new D(n.byteLength);var i=new j(r);i.set(n);return r};L.prototype={slice:function(t,e){return new L(this.a.slice(t,e))},__class__:L};var T=function(t,e,n){this.buf=t;if(e==null)this.offset=0;else this.offset=e;if(n==null)this.length=t.byteLength-this.offset;else this.length=n;if(this.offset<0||this.length<0||this.offset+this.length>t.byteLength)throw new S(b.OutsideBounds)};T.__name__=true;T.prototype={getInt8:function(t){var e=this.buf.a[this.offset+t];if(e>=128)return e-256;else return e},getUint8:function(t){return this.buf.a[this.offset+t]},getInt16:function(t,e){var n=this.getUint16(t,e);if(n>=32768)return n-65536;else return n},getUint16:function(t,e){if(e)return this.buf.a[this.offset+t]|this.buf.a[this.offset+t+1]<<8;else return this.buf.a[this.offset+t]<<8|this.buf.a[this.offset+t+1]},getInt32:function(t,e){var n=this.offset+t;var r=this.buf.a[n++];var i=this.buf.a[n++];var a=this.buf.a[n++];var s=this.buf.a[n++];if(e)return r|i<<8|a<<16|s<<24;else return s|a<<8|i<<16|r<<24},getUint32:function(t,e){var n=this.getInt32(t,e);if(n<0)return n+4294967296;else return n},getFloat32:function(t,e){return m.i32ToFloat(this.getInt32(t,e))},getFloat64:function(t,e){var n=this.getInt32(t,e);var r=this.getInt32(t+4,e);return m.i64ToDouble(e?n:r,e?r:n)},setInt8:function(t,e){if(e<0)this.buf.a[t+this.offset]=e+128&255;else this.buf.a[t+this.offset]=e&255},setUint8:function(t,e){this.buf.a[t+this.offset]=e&255},setInt16:function(t,e,n){this.setUint16(t,e<0?e+65536:e,n)},setUint16:function(t,e,n){var r=t+this.offset;if(n){this.buf.a[r]=e&255;this.buf.a[r++]=e>>8&255}else{this.buf.a[r++]=e>>8&255;this.buf.a[r]=e&255}},setInt32:function(t,e,n){this.setUint32(t,e,n)},setUint32:function(t,e,n){var r=t+this.offset;if(n){this.buf.a[r++]=e&255;this.buf.a[r++]=e>>8&255;this.buf.a[r++]=e>>16&255;this.buf.a[r++]=e>>>24}else{this.buf.a[r++]=e>>>24;this.buf.a[r++]=e>>16&255;this.buf.a[r++]=e>>8&255;this.buf.a[r++]=e&255}},setFloat32:function(t,e,n){this.setUint32(t,m.floatToI32(e),n)},setFloat64:function(t,e,n){var r=m.doubleToI64(e);if(n){this.setUint32(t,r.low);this.setUint32(t,r.high)}else{this.setUint32(t,r.high);this.setUint32(t,r.low)}},__class__:T};var k=function(){};k.__name__=true;k._new=function(t,e,n){var r;if(typeof t=="number"){r=[];var i=0;while(i<t){var a=i++;r[a]=0}r.byteLength=r.length;r.byteOffset=0;r.buffer=new L(r)}else if(B.__instanceof(t,L)){var s=t;if(e==null)e=0;if(n==null)n=s.byteLength-e;if(e==0)r=s.a;else r=s.a.slice(e,e+n);r.byteLength=r.length;r.byteOffset=e;r.buffer=s}else if(t instanceof Array&&t.__enum__==null){r=t.slice();r.byteLength=r.length;r.byteOffset=0;r.buffer=new L(r)}else throw new S("TODO "+_.string(t));r.subarray=k._subarray;r.set=k._set;return r};k._set=function(t,e){var n=this;if(B.__instanceof(t.buffer,L)){var r=t;if(t.byteLength+e>n.byteLength)throw new S("set() outside of range");var i=0;var a=t.byteLength;while(i<a){var s=i++;n[s+e]=r[s]}}else if(t instanceof Array&&t.__enum__==null){var o=t;if(o.length+e>n.byteLength)throw new S("set() outside of range");var u=0;var f=o.length;while(u<f){var l=u++;n[l+e]=o[l]}}else throw new S("TODO")};k._subarray=function(t,e){var n=this;var r=k._new(n.slice(t,e));r.byteOffset=t;return r};if(Array.prototype.indexOf)a.indexOf=function(t,e,n){return Array.prototype.indexOf.call(t,e,n)};String.prototype.__class__=String;String.__name__=true;Array.__name__=true;var q={__name__:["Int"]};var E={__name__:["Dynamic"]};var M=Number;M.__name__=["Float"];var C=Boolean;C.__ename__=["Bool"];var A={__name__:["Class"]};var U={};if(Array.prototype.map==null)Array.prototype.map=function(t){var e=[];var n=0;var r=this.length;while(n<r){var i=n++;e[i]=t(this[i])}return e};var D=n.ArrayBuffer||L;if(D.prototype.slice==null)D.prototype.slice=L.sliceImpl;var I=n.DataView||T;var j=n.Uint8Array||k._new;s.addressSpace=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"].map(function(t){return a.cca(t,0)});s.services={backend:"https://api.cyph.com",chat:"https://cyph.im/#",telehealth:"https://cyph.healthcare/#",video:"https://cyph.video/#",voice:"https://cyph.audio/#"};s.options={disableP2P:1,modestBranding:2,telehealth:3,video:4,voice:5};m.i64tmp=function(t){var e;var n=new p(0,0);e=n;return e}(this);B.__toStr={}.toString;k.BYTES_PER_ELEMENT=1})(typeof console!="undefined"?console:{log:function(){}},typeof window!="undefined"?window:exports,typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:this);