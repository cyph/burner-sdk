// Generated by Haxe 3.4.2
package haxe.root;

import haxe.root.*;

@SuppressWarnings(value={"rawtypes", "unchecked"})
public class Cyph extends haxe.lang.HxObject
{
	static
	{
		//line 8 "/cyph/Cyph.hx"
		haxe.root.Cyph.addressSpace = ((haxe.root.Array<java.lang.Object>) (new haxe.root.Array<java.lang.String>(new java.lang.String[]{"0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "A", "B", "C", "D", "E", "F", "G", "H", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"}).map(((haxe.lang.Function) (( (( haxe.root.Cyph_Anon_15__Fun.__hx_current != null )) ? (haxe.root.Cyph_Anon_15__Fun.__hx_current) : (haxe.root.Cyph_Anon_15__Fun.__hx_current = ((haxe.root.Cyph_Anon_15__Fun) (new haxe.root.Cyph_Anon_15__Fun()) )) )) ))) );
		//line 19 "/cyph/Cyph.hx"
		haxe.root.Cyph.services = new haxe.lang.DynamicObject(new java.lang.String[]{"backend", "chat", "telehealthVideo", "video", "voice"}, new java.lang.Object[]{"https://api.cyph.com", "https://cyph.im/#", "https://cyph.healthcare/#", "https://cyph.video/#", "https://cyph.audio/#"}, new java.lang.String[]{}, new double[]{});
		//line 27 "/cyph/Cyph.hx"
		haxe.root.Cyph.options = new haxe.lang.DynamicObject(new java.lang.String[]{}, new java.lang.Object[]{}, new java.lang.String[]{"disableP2P", "modestBranding", "nativeCrypto", "telehealth", "video", "voice"}, new double[]{((double) (((double) (1) )) ), ((double) (((double) (2) )) ), ((double) (((double) (3) )) ), ((double) (((double) (4) )) ), ((double) (((double) (5) )) ), ((double) (((double) (6) )) )});
	}
	
	public Cyph(haxe.lang.EmptyObject empty)
	{
	}
	
	
	public Cyph()
	{
		//line 7 "/cyph/Cyph.hx"
		haxe.root.Cyph.__hx_ctor__Cyph(this);
	}
	
	
	public static void __hx_ctor__Cyph(haxe.root.Cyph __hx_this)
	{
	}
	
	
	public static haxe.root.Array<java.lang.Object> addressSpace;
	
	public static java.lang.Object services;
	
	public static java.lang.Object options;
	
	public static java.lang.String generateGuid(int length)
	{
		//line 37 "/cyph/Cyph.hx"
		int byteLength = ( length * 4 );
		//line 38 "/cyph/Cyph.hx"
		haxe.io.Bytes randomBytes = haxe.root.SecureRandom.getSecureRandomBytes(byteLength);
		//line 39 "/cyph/Cyph.hx"
		haxe.io.ArrayBufferViewImpl randomNumbers = haxe.io._UInt32Array.UInt32Array_Impl_.fromBytes(randomBytes, null, null);
		//line 41 "/cyph/Cyph.hx"
		{
			//line 41 "/cyph/Cyph.hx"
			int _g1 = 0;
			//line 41 "/cyph/Cyph.hx"
			int _g = length;
			//line 41 "/cyph/Cyph.hx"
			while (( _g1 < _g ))
			{
				//line 41 "/cyph/Cyph.hx"
				int i = _g1++;
				//line 42 "/cyph/Cyph.hx"
				{
					//line 43 "/cyph/Cyph.hx"
					haxe.io.Bytes _this = ((haxe.io.ArrayBufferViewImpl) (randomNumbers) ).bytes;
					//line 43 "/cyph/Cyph.hx"
					int pos = ( (( i << 2 )) + ((haxe.io.ArrayBufferViewImpl) (randomNumbers) ).byteOffset );
					//line 43 "/cyph/Cyph.hx"
					int _int = ((int) (( ( ( ( _this.b[pos] & 255 ) | ( (( _this.b[( pos + 1 )] & 255 )) << 8 ) ) | ( (( _this.b[( pos + 2 )] & 255 )) << 16 ) ) | ( (( _this.b[( pos + 3 )] & 255 )) << 24 ) )) );
					//line 42 "/cyph/Cyph.hx"
					int v = ((int) (haxe.lang.Runtime.toInt(haxe.root.Cyph.addressSpace.__get(((int) (((double) (((int) (java.lang.Math.floor(( ( (( (( _int < 0 )) ? (( 4294967296.0 + _int )) : (( _int + 0.0 )) )) / 4294967296.0 ) * haxe.root.Cyph.addressSpace.length ))) )) )) )))) );
					//line 42 "/cyph/Cyph.hx"
					randomBytes.b[i] = ((byte) (v) );
				}
				
			}
			
		}
		
		//line 47 "/cyph/Cyph.hx"
		java.lang.String guid = new haxe.io.BytesInput(randomBytes, 0, length).readString(length);
		//line 48 "/cyph/Cyph.hx"
		randomBytes.fill(0, byteLength, 0);
		//line 49 "/cyph/Cyph.hx"
		return guid;
	}
	
	
	public static void request(java.lang.String url, boolean post, haxe.root.Array<java.lang.Object> headers, haxe.root.Array<java.lang.Object> parameters, haxe.lang.Function onData, haxe.lang.Function onError)
	{
		//line 108 "/cyph/Cyph.hx"
		haxe.Http http = new haxe.Http(haxe.lang.Runtime.toString(url));
		//line 109 "/cyph/Cyph.hx"
		http.onData = onData;
		//line 110 "/cyph/Cyph.hx"
		http.onError = onError;
		//line 112 "/cyph/Cyph.hx"
		if (post) 
		{
			//line 113 "/cyph/Cyph.hx"
			http.setPostData("");
		}
		
		//line 116 "/cyph/Cyph.hx"
		{
			//line 116 "/cyph/Cyph.hx"
			int _g = 0;
			//line 116 "/cyph/Cyph.hx"
			while (( _g < headers.length ))
			{
				//line 116 "/cyph/Cyph.hx"
				java.lang.Object o = headers.__get(_g);
				//line 116 "/cyph/Cyph.hx"
				 ++ _g;
				//line 117 "/cyph/Cyph.hx"
				http.setHeader(haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(o, "k", true)), haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(o, "v", true)));
			}
			
		}
		
		//line 120 "/cyph/Cyph.hx"
		{
			//line 120 "/cyph/Cyph.hx"
			int _g1 = 0;
			//line 120 "/cyph/Cyph.hx"
			while (( _g1 < parameters.length ))
			{
				//line 120 "/cyph/Cyph.hx"
				java.lang.Object o1 = parameters.__get(_g1);
				//line 120 "/cyph/Cyph.hx"
				 ++ _g1;
				//line 121 "/cyph/Cyph.hx"
				http.setParameter(haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(o1, "k", true)), haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(o1, "v", true)));
			}
			
		}
		
		//line 124 "/cyph/Cyph.hx"
		http.request(post);
	}
	
	
	public static java.lang.Object generateLink(haxe.root.Array<java.lang.Object> options, java.lang.Object services)
	{
		//line 137 "/cyph/Cyph.hx"
		java.lang.String id = haxe.root.Cyph.generateGuid(7);
		//line 139 "/cyph/Cyph.hx"
		{
			//line 141 "/cyph/Cyph.hx"
			java.lang.String __temp_odecl1 = ( ( ( ( ( ( (( (( options.indexOf(((int) (haxe.lang.Runtime.getField_f(haxe.root.Cyph.options, "video", true)) ), null) > -1 )) ? (( (( options.indexOf(((int) (haxe.lang.Runtime.getField_f(haxe.root.Cyph.options, "telehealth", true)) ), null) > -1 )) ? (haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(services, "telehealthVideo", true))) : (haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(services, "video", true))) )) : (( (( options.indexOf(((int) (haxe.lang.Runtime.getField_f(haxe.root.Cyph.options, "voice", true)) ), null) > -1 )) ? (haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(services, "voice", true))) : (haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(services, "chat", true))) )) )) + (( (( ( options.indexOf(((int) (haxe.lang.Runtime.getField_f(haxe.root.Cyph.options, "telehealth", true)) ), null) > -1 ) && ( options.indexOf(((int) (haxe.lang.Runtime.getField_f(haxe.root.Cyph.options, "video", true)) ), null) < 0 ) )) ? ("@") : ("") )) ) + (( (( options.indexOf(((int) (haxe.lang.Runtime.getField_f(haxe.root.Cyph.options, "modestBranding", true)) ), null) > -1 )) ? ("!") : ("") )) ) + (( (( options.indexOf(((int) (haxe.lang.Runtime.getField_f(haxe.root.Cyph.options, "disableP2P", true)) ), null) > -1 )) ? ("$") : ("") )) ) + (( (( options.indexOf(((int) (haxe.lang.Runtime.getField_f(haxe.root.Cyph.options, "nativeCrypto", true)) ), null) > -1 )) ? ("*") : ("") )) ) + id ) + haxe.root.Cyph.generateGuid(19) );
			//line 139 "/cyph/Cyph.hx"
			return new haxe.lang.DynamicObject(new java.lang.String[]{"id", "link"}, new java.lang.Object[]{id, __temp_odecl1}, new java.lang.String[]{}, new double[]{});
		}
		
	}
	
	
	public static void initiateSession(java.lang.String apiKey, haxe.root.Array<java.lang.Object> options, java.lang.Object services, haxe.lang.Function onData, haxe.lang.Function onError)
	{
		//line 183 "/cyph/Cyph.hx"
		if (( options == null )) 
		{
			//line 184 "/cyph/Cyph.hx"
			options = new haxe.root.Array<java.lang.Object>(new java.lang.Object[]{});
		}
		
		//line 192 "/cyph/Cyph.hx"
		if (( services == null )) 
		{
			//line 193 "/cyph/Cyph.hx"
			services = haxe.root.Cyph.services;
		}
		
		//line 201 "/cyph/Cyph.hx"
		if (( haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(services, "backend", true)) == null )) 
		{
			//line 202 "/cyph/Cyph.hx"
			haxe.lang.Runtime.setField(services, "backend", haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(haxe.root.Cyph.services, "backend", true)));
		}
		
		//line 204 "/cyph/Cyph.hx"
		if (( haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(services, "telehealthVideo", true)) == null )) 
		{
			//line 205 "/cyph/Cyph.hx"
			haxe.lang.Runtime.setField(services, "telehealthVideo", ( haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(services, "chat", true)) + "video/@" ));
		}
		
		//line 207 "/cyph/Cyph.hx"
		if (( haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(services, "video", true)) == null )) 
		{
			//line 208 "/cyph/Cyph.hx"
			haxe.lang.Runtime.setField(services, "video", ( haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(services, "chat", true)) + "video/" ));
		}
		
		//line 210 "/cyph/Cyph.hx"
		if (( haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(services, "voice", true)) == null )) 
		{
			//line 211 "/cyph/Cyph.hx"
			haxe.lang.Runtime.setField(services, "voice", ( haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(services, "chat", true)) + "audio/" ));
		}
		
		//line 214 "/cyph/Cyph.hx"
		java.lang.Object linkData = haxe.root.Cyph.generateLink(options, services);
		//line 216 "/cyph/Cyph.hx"
		haxe.root.Cyph.request(( ( haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(services, "backend", true)) + "/preauth/" ) + haxe.lang.Runtime.toString(haxe.lang.Runtime.getField(linkData, "id", true)) ), true, new haxe.root.Array<java.lang.Object>(new java.lang.Object[]{new haxe.lang.DynamicObject(new java.lang.String[]{"k", "v"}, new java.lang.Object[]{"Authorization", apiKey}, new java.lang.String[]{}, new double[]{})}), new haxe.root.Array<java.lang.Object>(new java.lang.Object[]{}), new haxe.root.Cyph_initiateSession_221__Fun(onData, linkData), onError);
	}
	
	
}


